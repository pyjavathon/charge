<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>test page</title>
<script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=mzvtqg5q27"></script>

<script src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>
<script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId="></script>
<script type="text/javascript" th:src="@{/js/MarkerClustering.js}" ></script>
     <style type="text/css">
        html, body { width:100%;height:100%;padding:0;margin:0; }
    </style>
</head>
<body>
<div id="map" style="width:100%;height:100%;padding:0;margin:0;"></div>
<script th:inline="javascript">

	
	var map = new naver.maps.Map('map', {
        center: new naver.maps.LatLng(37.552758094502494, 126.98732600494576), //지도 시작 지점
        zoom: ,
        zoomControl: true,
        zoomControlOptions: {
            position: naver.maps.Position.TOP_LEFT,
            style: naver.maps.ZoomControlStyle.SMALL
        }
    });
    var markers = [], // 마커 정보를 담는 배열
		data = [[${dots}]],
		infoWindows = [];
		console.log(data);
    
    for (var i = 0, ii = data.length; i < ii; i++) {
        var spot = data[i],
            latlng = new naver.maps.LatLng(spot.lat, spot.lon),
            marker = new naver.maps.Marker({
                position: latlng,
                draggable: true
            });
        
        var infoWindow = new naver.maps.InfoWindow({
        	content: '<div style="width:200px;text-align:center;padding:10px;"><b>' + data[i].statNm + '</b><br> - 네이버 지도 - </div>'
		 });

        markers.push(marker);
        infoWindows.push(infoWindow);
    }
    
	var htmlMarker1 = {
	        content: '<div style="cursor:pointer;width:40px;height:40px;line-height:42px;font-size:10px;color:white;text-align:center;font-weight:bold;background:url(/img/free-icon-full-moon-1281188.png);background-size:contain;"></div>',
	        size: N.Size(40, 40),
	        anchor: N.Point(20, 20)
	    },
	    htmlMarker2 = {
	        content: '<div style="cursor:pointer;width:40px;height:40px;line-height:42px;font-size:10px;color:white;text-align:center;font-weight:bold;background:url(/img/free-icon-full-moon-1281188.png);background-size:contain;"></div>',
	        size: N.Size(40, 40),
	        anchor: N.Point(20, 20)
	    },
	    htmlMarker3 = {
	        content: '<div style="cursor:pointer;width:40px;height:40px;line-height:42px;font-size:10px;color:white;text-align:center;font-weight:bold;background:url(/img/free-icon-full-moon-1281188.png);background-size:contain;"></div>',
	        size: N.Size(40, 40),
	        anchor: N.Point(20, 20)
	    },
	    htmlMarker4 = {
	        content: '<div style="cursor:pointer;width:40px;height:40px;line-height:42px;font-size:10px;color:white;text-align:center;font-weight:bold;background:url(/img/free-icon-full-moon-1281188.png);background-size:contain;"></div>',
	        size: N.Size(40, 40),
	        anchor: N.Point(20, 20)
	    },
	    htmlMarker5 = {
	        content: '<div style="cursor:pointer;width:40px;height:40px;line-height:42px;font-size:10px;color:white;text-align:center;font-weight:bold;background:url(/img/free-icon-full-moon-1281188.png);background-size:contain;"></div>',
	        size: N.Size(40, 40),
	        anchor: N.Point(20, 20)
	    };
	
	    var markerClustering = new MarkerClustering({
	        minClusterSize: 2,
	        maxZoom: 8,
	        map: map,
	        markers: markers,
	        disableClickZoom: false,
	        gridSize: 120,
	        icons: [htmlMarker1, htmlMarker2, htmlMarker3, htmlMarker4, htmlMarker5],
	        indexGenerator: [10, 100, 200, 500, 1000],
	        stylingFunction: function(clusterMarker, count) {
	            $(clusterMarker.getElement()).find('div:first-child').text(count);
	        }
	    });
	    
	    function getClickHandler(seq){
	    	return function(e){
	    		var marker = markers[seq],
	    			infoWindow = infoWindows[seq];
	    		if(infoWindow.getMap()){
	    			infoWindow.close();
	    		}else{
	    			infoWindow.open(map,marker);
	    		}
	    	}
	    }
	    
	    for(var i = 0, ii = markers.length; i< ii; i++){
	    	naver.maps.Event.addListener(markers[i],'click',getClickHandler(i));
	    }
	
</script>
</body>
</html>